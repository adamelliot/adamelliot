
window.CanvasObject=window.CanvasObject||{};CanvasObject.Color=(function(){var Klass=function(r,g,b,a){this.red=Math.round(r||(isNaN(r)&&0));this.green=Math.round(g||(isNaN(g)&&0));this.blue=Math.round(b||(isNaN(b)&&255));this.alpha=a||(isNaN(a)&&1.0);this.r=function(val){this.red=parseInt(val);return this;};this.g=function(val){this.green=parseInt(val);return this;}
this.b=function(val){this.blue=parseInt(val);return this;}
this.a=function(val){this.alpha=parseFloat(val);return this;}};Klass.prototype.toString=function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")";};Klass.fromHex=function(hex,alpha){return new Klass(hex>>16,(hex>>8)&0xff,hex&0xff,alpha||1.0);};Klass.random=function(alpha){return Klass.fromHex(Math.floor(Math.random()*0xffffff),alpha);};Klass.randomGrey=function(alpha){var color=Math.floor(Math.random()*128)+120;return new Klass(color,color,color,alpha||1.0);};var COLOR_SETS={'black':[0,0,0],'clear':[0,0,0,0.0],'blue':[0,0,255],'red':[255,0,0],'green':[0,255,0],'yellow':[255,255,0],'orange':[255,128,0]};for(var color in COLOR_SETS)
(function(){var arr=COLOR_SETS[color];Klass[color]=function(){return new Klass(arr[0],arr[1],arr[2],arr[3]);};})();return Klass;})();window.CanvasObject=window.CanvasObject||{};CanvasObject.Events=CanvasObject.Events||{};CanvasObject.Events.EventListener=(function(){var Klass=function(){var events={};this.defineHook=function(name){if(events[name])return;events[name]=[];this[name]=function(fn){events[name].push(fn);};};this.events=function(){return events;};this.trigger=function(event){var target=events[event];for(var i=0;i<target.length;i++)target[i].apply(this,arguments);};this.removeHandler=function(event,handler){if(!events[event])return;for(var i=0;i<events[event].length;i++)
if(events[event][i]==handler)events[event].splice(i--,1);};this.bind=function(event,fn){};this.unbind=function(event,fn){};};return Klass;})();window.CanvasObject=window.CanvasObject||{};CanvasObject.Geometry=CanvasObject.Geometry||{};CanvasObject.Geometry.Point=(function(){var Klass=function(x,y){this.x=x||0;this.y=y||0;this.equals=function(other){return(other.x==this.x&&other.y==this.y);};this.clone=function(){return new CanvasObject.Geometry.Point(this.x,this.y);};this.add=function(vec){this.x+=vec.x;this.y+=vec.y;return this;};this.subtract=function(vec){this.x-=vec.x;this.y-=vec.y;return this;}
this.distanceTo=function(pt){var x=this.x-pt.x;var y=this.y-pt.y;return Math.sqrt(x*x+y*y);};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};};Klass.random=function(x,y){return new Klass(Math.random()*x,Math.random()*y);}
Klass.distance=function(p1,p2){var x=p1.x-p2.x;var y=p1.y-p2.y;return Math.sqrt(x*x+y*y);};Klass.interpolate=function(p1,p2,weight){weight=weight||0.5;return new CanvasObject.Geometry.Point(p1.x*(1-weight)+p2.x*weight,p1.y*(1-weight)+p2.y*weight);};Klass.add=function(pt,vec){return pt.clone().add(vec);};Klass.subtract=function(pt,vec){return pt.clone().subtract(vec);};return Klass;})();CanvasObject.Geometry.Vector=(function(){var Klass=function(x,y){this.x=x||0;this.y=y||0;this.equals=function(other){return(other.x==this.x&&other.y==this.y);};this.eq=this.equals;this.clone=function(){return new CanvasObject.Geometry.Vector(this.x,this.y);};this.dot=function(vec){return vec.x*this.x+vec.y*this.y;};this.multiply=function(s){this.x*=s;this.y*=s;return this;};this.mul=this.multiply;this.divide=function(s){this.x/=s;this.y/=s;return this;};this.div=this.divide;this.add=function(vec){this.x+=vec.x;this.y+=vec.y;return this;};this.subtract=function(vec){this.x-=vec.x;this.y-=vec.y;return this;};this.sub=this.subtract;this.angle=function(){return Math.atan2(this.y,this.x);};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};this.perpendicular=function(){return new CanvasObject.Geometry.Vector(-this.y,this.x);};};Klass.add=function(v1,v2){return v1.clone().add(v2);};Klass.subtract=function(v1,v2){return v1.clone().subtract(v2);};Klass.sub=Klass.subtract;Klass.fromAngle=function(angle){var ret=new CanvasObject.Geometry.Vector;ret.x=Math.cos(angle);ret.y=Math.sin(angle);return ret;};return Klass;})();CanvasObject.Geometry.Size=(function(){var Klass=function(width,height){this.width=width||0;this.height=height||0;};return Klass;})();CanvasObject.Geometry.Matrix=(function(){var Klass=function(){var m=[[1,0],[0,1]];this.rotate=function(angle){m[0][0]=Math.cos(angle);m[0][1]=Math.sin(angle);m[1][0]=-Math.sin(angle);m[1][1]=Math.cos(angle);};this.transform=function(pt){var x=pt.x*m[0][0]+pt.y*m[1][0];var y=pt.x*m[0][1]+pt.y*m[1][1];pt.x=x;pt.y=y;return pt;};};Klass.rotatePoint=function(pt,angle){var mat=new Klass();mat.rotate(angle);return mat.transform(pt);};return Klass;})();CanvasObject.Geometry.Rectangle=(function(){var Klass=function(left,top,right,bottom){if(arguments.length==0)this.empty=true;else{this.empty=false;if(left<=right){this.left=left;this.right=right;}else{this.left=right;this.right=left;}
if(top<=bottom){this.top=top;this.bottom=bottom;}else{this.top=bottom;this.bottom=top;}}
this.clone=function(){return new Klass(this.left,this.top,this.right,this.bottom);};this.width=function(){return this.right-this.left;};this.height=function(){return this.bottom-this.top;};this.includePoint=function(pt){if(this.empty){this.empty=false;this.left=this.right=pt.x;this.top=this.bottom=pt.y;return;}
if(this.left>pt.x)this.left=pt.x;else if(this.right<pt.x)this.right=pt.x;if(this.top>pt.y)this.top=pt.y;else if(this.bottom<pt.y)this.bottom=pt.y;};};Klass.fromRotated=function(rect,angle){if(angle==0)return rect.clone();var mat=new CanvasObject.Geometry.Matrix();mat.rotate(angle);var pt1=mat.transform({x:rect.left,y:rect.top});var pt2=mat.transform({x:rect.right,y:rect.bottom});var r=new Klass(pt1.x,pt1.y,pt2.x,pt2.y);r.includePoint(mat.transform({x:rect.right,y:rect.top}));r.includePoint(mat.transform({x:rect.left,y:rect.bottom}));return r;};return Klass;})();window.CanvasObject=window.CanvasObject||{};CanvasObject.Motion=CanvasObject.Motion||{};window.CanvasObject=window.CanvasObject||{};CanvasObject.Base=(function(){var Klass=function(){CanvasObject.Events.EventListener.call(this);CanvasObject.Geometry.Point.call(this);CanvasObject.Geometry.Rectangle.call(this);var parent;this.x=0;this.y=0;this.rotation=0;this.scale=1.0;this.defineHook('enterFrame');this.defineHook('afterRemove');this.draw=function(){};this.drawInto=function(context){};this.setParent=function(value){parent=value;};this.parent=function(){return parent;};this.context=function(){return null;};this.remove=function(){if(parent){parent.removeChild(this);this.trigger('afterRemove');}};this.applyTransform=function(context){context.translate(this.x,this.y);context.rotate(this.rotation);context.scale(this.scale,this.scale);};};Klass.prototype=new CanvasObject.Events.EventListener;return Klass;})();CanvasObject.Bitmap=(function(){var Klass=function(width,height){CanvasObject.Base.call(this);var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext('2d');this.canvas=function(){return canvas;};this.context=function(){return context;};this.drawInto=function(context){context.drawImage(this.canvas(),this.x,this.y);};this.addBitmap=function(bitmap){bitmap.drawInto(context);};this.width=function(){return canvas.width;};this.height=function(){return canvas.height;};};Klass.prototype=new CanvasObject.Base;Klass.withImage=function(path,callback){var image=new Image;image.onload=function(){var bitmap=new Klass(image.width,image.height);bitmap.context().drawImage(image,0,0);callback(bitmap);}
image.src=path;};Klass.withCanvasObject=function(canvasObject){var rect=CanvasObject.Geometry.Rectangle.fromRotated(canvasObject,canvasObject.rotation);var bitmap=new CanvasObject.Bitmap(rect.width(),rect.height());bitmap.x=rect.left+canvasObject.x;bitmap.y=rect.top+canvasObject.y;var x=canvasObject.x;var y=canvasObject.y;canvasObject.x=-rect.left;canvasObject.y=-rect.top;canvasObject.drawInto(bitmap.context());canvasObject.x=x;canvasObject.y=y;var ctx=bitmap.context();return bitmap;};return Klass;})();CanvasObject.Path=(function(){var METHODS=['beginPath','closePath','moveTo','lineTo','bezierCurveTo','quadraticCurveTo','arc','drawImage','fillRect','strokeRect','fill','stroke'];var PROPS=['fillStyle','strokeStyle','shadowOffsetX','shadowOffsetY','shadowBlur','shadowColor'];var Klass=function(){CanvasObject.Base.call(this);var commands=[];for(var i=0;i<METHODS.length;i++){(function(){var command=METHODS[i];this[command]=function(){commands.push([command,arguments]);return commands.length-1;};this[command+'At']=function(){var arr=Array.prototype.slice.call(arguments);commands[arr.shift()]=[command,arr];return commands.length-1;};}).call(this);}
this.moveTo=function(x,y){this.includePoint({x:x,y:y});commands.push(['moveTo',arguments]);return commands.length-1;};this.lineTo=function(x,y){this.includePoint({x:x,y:y});commands.push(['lineTo',arguments]);return commands.length-1;};this.bezierCurveTo=function(px1,py1,px2,py2,x,y){this.includePoint({x:px1,y:py1});this.includePoint({x:px2,y:py2});this.includePoint({x:x,y:y});commands.push(['bezierCurveTo',arguments]);return commands.length-1;};this.quadraticCurveTo=function(px,py,x,y){this.includePoint({x:px,y:py});this.includePoint({x:x,y:y});commands.push(['quadraticCurveTo',arguments]);return commands.length-1;};this.commands=function(){return commands;};this.removeCommandAt=function(index){commands[index]=null;};this.clear=function(){commands=[];};this.toBitmap=function(){return CanvasObject.Bitmap.withCanvasObject(this);};this.drawInto=function(context,boundingBox){context.save();this.applyState(context);var commands=this.commands();for(var j=0;j<commands.length;j++)
if(commands[j])
context[commands[j][0]].apply(context,commands[j][1]);context.restore();};this.applyState=function(context){this.applyTransform(context);for(var i=0;i<PROPS.length;i++){if(this[PROPS[i]])
context[PROPS[i]]=this[PROPS[i]];}};};Klass.prototype=new CanvasObject.Base;return Klass;})();CanvasObject.Container=(function(){var Klass=function(){CanvasObject.Base.call(this);var children=[];this.addChild=function(child){children.push(child);child.setParent(this);child._enterFrame=function(){child.trigger('enterFrame');}
this.enterFrame(child._enterFrame);};this.children=function(){return children;};this.removeChild=function(child){for(var i=0;i<children.length;i++)
if(children[i]==child)break;if(i==children.length)return;children.splice(i,1);this.removeHandler('enterFrame',child._enterFrame);};this.drawInto=function(context){context.save();this.applyTransform(context);for(var i=0;i<children.length;i++)
children[i].drawInto(context);context.restore();}};Klass.prototype=new CanvasObject.Base;return Klass;})();CanvasObject.Stage=(function(){var Klass=function(target,_fps){var self=this;var origin=new CanvasObject.Geometry.Point(0,0);CanvasObject.Container.call(this);var interval,fps,currentFps=0,canvas,context;var noClearDraw,clearDraw,updateFps,drawFunc;var initialize=function(){if(!target)return;canvas=typeof target=='string'?document.getElementById(target):target;if(!canvas.getContext)throw"Uh oh! Can't get a context.";context=canvas.getContext('2d');if(!context)throw"Uh oh! Can't get a context.";drawFunc=clearDraw;this.enterFrame(drawFunc);this.setFrameRate(_fps);};noClearDraw=function(){self.drawInto(context);};this.clearFunc=function(){context.clearRect(-origin.x,-origin.y,canvas.width,canvas.height);};clearDraw=function(){self.clearFunc();self.drawInto(context);};var updateFps=function(){var lastTime=0,lastDiff=0;var i=0;updateFps=function(){var time=(new Date()).getTime();var diff=(time-lastTime);lastDiff=diff*0.5+lastDiff*0.5;lastTime=time;currentFps=Math.round(1000/lastDiff);};};updateFps();this.setUpdateMethod=function(clear,calcFps){this.removeHandler('enterFrame',drawFunc);this.removeHandler('enterFrame',updateFps);if(clear)this.enterFrame(drawFunc=clearDraw);else this.enterFrame(drawFunc=noClearDraw);if(calcFps)this.enterFrame(updateFps);};this.setOrigin=function(_origin){if(typeof _origin=='number')
_origin=new CanvasObject.Geometry.Point(arguments[0],arguments[1]);origin=_origin;context.translate(origin.x,origin.y);};this.setFrameRate=function(value){if(!value||interval!=undefined)return;var ms=1000/(fps=value);interval=setInterval(function(){self.trigger('enterFrame');},ms);};this.width=function(){return canvas.width;};this.height=function(){return canvas.height;};this.resize=function(width,height){canvas.width=width;canvas.height=height;this.trigger('enterFrame');};this.stop=function(){clearInterval(interval);interval=undefined;};this.play=function(){this.setFrameRate(fps);};this.fps=function(){return currentFps;};this.context=function(){return context;};initialize.call(this);};Klass.prototype=new CanvasObject.Container;return Klass;})();